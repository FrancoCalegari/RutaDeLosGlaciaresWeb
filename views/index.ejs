<!DOCTYPE html>
<html lang="es">
	<%- include('partials/head') %>
	<body>
		<%- include('partials/header') %>

		<!-- Fondo dinámico -->
		<div id="dynamic-background">
			<img
				src="<%= background.src %>"
				alt="Fondo dinámico"
				class="background-img"
			/>
			<div class="background-blur"></div>
		</div>

		<div class="hero">
			<img
				src="./assets/img/logo.png"
				alt="Rutas De Los Glaciares Logo"
				class="logo-hero"
			/>
			<h1>Rutas De Los Glaciares</h1>
			<p>Traslados y excursiones privadas en El Calafate y El Chaltén</p>
		</div>

		<div class="productos" id="productos">
			<h2>Nuestros Productos</h2>
			<div class="producto-lista">
				<% const priceFormatter = new Intl.NumberFormat("es-AR", {
				minimumFractionDigits: 0, maximumFractionDigits: 2, }); %> <%
				products.forEach(product => { %> <% const priceValue =
				parseFloat(product.precioProducto) || 0; const discountValue =
				parseFloat(product.descuentoProducto) || 0; const hasDiscount =
				discountValue > 0; const finalPrice = hasDiscount ? priceValue -
				priceValue * (discountValue / 100) : priceValue; const whatsappParts =
				[
					"Hola, estoy interesado en el producto " + product.nombreProducto + ".",
					"Detalles: " + product.detalleProducto
				]; if (product.extrasProducto) {
				whatsappParts.push("Extras: " + product.extrasProducto);
				} whatsappParts.push("¿Podrían brindarme más información?"); const
				whatsappMessage = encodeURIComponent(whatsappParts.join(" "));
				const whatsappLink =
				"https://wa.me/5492617735869?text=" + whatsappMessage; %>
				<div class="producto-item">
					<% if (hasDiscount) { %>
					<span class="descuento-badge">-<%= discountValue %>%</span>
					<% } %>
					<img
						src="<%= product.imagenesProducto[0] %>"
						alt="<%= product.nombreProducto %>"
					/>
					<h3><%= product.nombreProducto %></h3>
					<p><%= product.detalleProducto %></p>
					<p><%= product.extrasProducto %></p>
					<span class="precio">
						<% if (hasDiscount) { %>
						<span class="precio-descuento"
							>$<%= priceFormatter.format(finalPrice) %></span
						>
						<span class="precio-original"
							>$<%= priceFormatter.format(priceValue) %></span
						>
						<% } else { %>
						<span class="precio-base"
							>$<%= priceFormatter.format(priceValue) %></span
						>
						<% } %>
					</span>
					<div class="producto-acciones">
						<button
							type="button"
							class="btn-comprar btn-mercadopago"
							data-product-id="<%= product.id %>"
							aria-label="Pagar <%= product.nombreProducto %> online"
						>
							<i class="fa-solid fa-credit-card"></i>
							Pagar online
						</button>
						<a
							class="btn-comprar btn-whatsapp"
							href="<%= whatsappLink %>"
							target="_blank"
							rel="noopener noreferrer"
							aria-label="Comprar <%= product.nombreProducto %> por WhatsApp"
						>
							<i class="fa-brands fa-whatsapp"></i>
							Comprar por WhatsApp
						</a>
					</div>
				</div>
				<% }) %>
			</div>
		</div>

		<!-- Carrusel -->
		<section id="carrusel">
			<h2>Galería de Imágenes</h2>
			<div class="carousel-container">
				<% images.forEach(img => { %>
				<img
					src="<%= img.src %>"
					alt="<%= img.alt %>"
					class="carousel-img"
					onclick="openModal(this)"
				/>
				<% }) %>
			</div>
		</section>

		<!-- Modal -->
		<div id="imageModal" class="modal">
			<span class="close" onclick="closeModal()">&times;</span>
			<div class="modalContainer">
				<div class="modalimagecontainer">
					<img class="modal-content" id="modalImage" />
				</div>

				<div id="caption"></div>
			</div>
		</div>

		<!-- Resumen -->
		<section id="resumen-servicios">
			<h2><%= summary.title %></h2>
			<p><%= summary.description %></p>
		</section>

		<!-- Servicios -->
		<section id="servicios">
			<h2>Servicios principales</h2>
			<% services.forEach(s => { %>
			<article>
				<h3><%= s.title %></h3>
				<% if (s.content) { %>
				<p><%= s.content %></p>
				<% } else if (s.items) { %>
				<ul>
					<% s.items.forEach(item => { %>
					<li><%= item %></li>
					<% }) %>
				</ul>
				<% } %>
			</article>
			<% }) %>
		</section>

		<!-- Ventajas -->
		<section id="ventajas">
			<h2><%= advantages.title %></h2>
			<ul>
				<% advantages.items.forEach(v => { %>
				<li><strong><%= v.strong %>:</strong> <%= v.text %></li>
				<% }) %>
			</ul>
		</section>

		<!-- Costos -->
		<section id="costos">
			<h2><%= costs.title %></h2>
			<ul>
				<% costs.items.forEach(c => { %>
				<li><%= c %></li>
				<% }) %>
			</ul>
		</section>

		<%- include('partials/footer') %>

		<a
			class="whatsapp-float"
			href="https://wa.me/5492617735869"
			target="_blank"
			rel="noopener noreferrer"
			aria-label="Contactar por WhatsApp"
		>
			<i class="fa-brands fa-whatsapp"></i>
		</a>

		<script>
			window.addEventListener("scroll", () => {
				const scrollY = window.scrollY;
				const body = document.body;
				if (scrollY > 150) {
					body.classList.add("scrolled");
				} else {
					body.classList.remove("scrolled");
				}
			});
		</script>

		<script>
			const modal = document.getElementById("imageModal");
			const modalImg = document.getElementById("modalImage");
			const captionText = document.getElementById("caption");
			function openModal(img) {
				modal.style.display = "block";
				modalImg.src = img.src;
				captionText.innerHTML = img.alt;
			}
			function closeModal() {
				modal.style.display = "none";
			}
			window.onclick = function (event) {
				if (event.target == modal) {
					modal.style.display = "none";
				}
			};
		</script>

		<div class="checkout-modal" id="checkout-modal" aria-hidden="true">
			<div
				class="checkout-modal__box"
				role="dialog"
				aria-modal="true"
				aria-labelledby="checkout-modal-title"
			>
				<button
					class="checkout-modal__close"
					type="button"
					data-close="true"
					aria-label="Cerrar formulario de pago"
				>
					<i class="fa-solid fa-xmark"></i>
				</button>
				<h3 id="checkout-modal-title">Completa tus datos</h3>
				<p class="checkout-modal__description">
					Usamos esta información para emitir el pago y enviarte el comprobante.
				</p>
				<form id="checkout-form">
					<div class="checkout-modal__grid">
						<label>
							<span>Nombre</span>
							<input type="text" name="name" autocomplete="given-name" required />
						</label>
						<label>
							<span>Apellido</span>
							<input
								type="text"
								name="lastName"
								autocomplete="family-name"
								required
							/>
						</label>
						<label class="checkout-modal__grid--full">
							<span>Correo electrónico</span>
							<input type="email" name="email" autocomplete="email" required />
						</label>
						<label>
							<span>Código de área</span>
							<input
								type="tel"
								name="areaCode"
								inputmode="numeric"
								pattern="[0-9]{1,5}"
								placeholder="Ej: 11"
							/>
						</label>
						<label>
							<span>Teléfono</span>
							<input
								type="tel"
								name="phone"
								inputmode="numeric"
								pattern="[0-9]{6,15}"
								placeholder="Ej: 55551234"
							/>
						</label>
						<label>
							<span>Cantidad</span>
							<input
								type="number"
								name="quantity"
								min="1"
								value="1"
								step="1"
								required
							/>
						</label>
					</div>
					<div class="checkout-modal__coupon">
						<label class="checkout-modal__coupon-label">
							<span>¿Tenés un cupón?</span>
							<input
								type="text"
								name="coupon"
								id="checkout-coupon"
								placeholder="Ej: BIENVENIDA10"
								autocomplete="off"
							/>
						</label>
						<button
							type="button"
							class="btn-comprar checkout-modal__coupon-apply"
							id="checkout-apply-coupon"
						>
							<i class="fa-solid fa-tag"></i>
							Aplicar cupón
						</button>
					</div>
					<p
						class="checkout-modal__coupon-feedback"
						id="checkout-coupon-feedback"
						hidden
					></p>
					<p class="checkout-modal__error" id="checkout-error" role="alert" hidden>
						No se pudo iniciar el pago, intenta más tarde.
					</p>
					<button type="submit" class="btn-comprar checkout-modal__submit">
						<i class="fa-solid fa-lock"></i>
						Ir a pagar
					</button>
				</form>
			</div>
		</div>

		<script>
			window.__MP_PUBLIC_KEY__ = "<%= mpPublicKey %>";
		</script>
		<script src="https://sdk.mercadopago.com/js/v2"></script>
		<script src="/assets/js/checkout.js" defer></script>
	</body>
</html>
